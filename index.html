<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Email Scheduler</title>

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
  font-family:system-ui,Arial;
  background:linear-gradient(135deg,#667eea,#764ba2);
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}
.container{
  background:#fff;
  max-width:760px;
  width:100%;
  padding:30px;
  border-radius:20px;
  box-shadow:0 25px 60px rgba(0,0,0,.3);
}
h1{text-align:center;color:#667eea;margin-bottom:10px}
label{font-weight:600}
input,textarea{
  width:100%;
  padding:12px;
  margin:6px 0 14px;
  border-radius:10px;
  border:2px solid #ddd;
}
textarea{min-height:100px}
button{
  padding:10px 16px;
  border:none;
  border-radius:8px;
  background:#667eea;
  color:#fff;
  cursor:pointer;
}
.message{
  display:none;
  padding:10px;
  border-radius:8px;
  margin-bottom:12px;
  color:#fff;
}
.success{background:#2ecc71}
.error{background:#e74c3c}
.email-item{
  background:#f4f7fb;
  padding:15px;
  border-radius:12px;
  margin-bottom:10px;
}
</style>
</head>

<body>
<div class="container">

<h1>ðŸ“§ Email Scheduler</h1>
<div id="msg" class="message"></div>

<form id="emailForm">
<label>To</label>
<input type="email" id="to" required>

<label>Subject</label>
<input type="text" id="subject" required>

<label>Message</label>
<textarea id="message" required></textarea>

<label>Date</label>
<input type="date" id="date" required>

<label>Time</label>
<input type="time" id="time" required>

<button type="submit">Schedule Email</button>
</form>

<hr style="margin:20px 0">
<div id="emailList"></div>

</div>

<script>
let emails = JSON.parse(localStorage.getItem("emails")) || [];
const list = document.getElementById("emailList");
const msgBox = document.getElementById("msg");

function showMsg(text,type){
  msgBox.textContent=text;
  msgBox.className="message "+type;
  msgBox.style.display="block";
  setTimeout(()=>msgBox.style.display="none",4000);
}

function save(){localStorage.setItem("emails",JSON.stringify(emails));}

function render(){
  list.innerHTML="";
  emails.forEach(e=>{
    list.innerHTML+=`
      <div class="email-item">
        <b>To:</b> ${e.to}<br>
        <b>Subject:</b> ${e.subject}<br>
        <b>Status:</b> ${e.status}
      </div>`;
  });
}

function sendEmail(e){
  fetch("/api/sendMail",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({
      to_email:e.to,
      subject:e.subject,
      message:e.message,
      sender_name:"A S Shridatta Aigal"
    })
  })
  .then(r=>r.json())
  .then(()=>{
    e.status="sent";
    save(); render();
    showMsg("Email sent âœ…","success");
  })
  .catch(()=>{
    showMsg("Email failed âŒ","error");
  });
}

function checkEmails(){
  const now=new Date();
  emails.forEach(e=>{
    if(e.status==="pending"){
      const t=new Date(`${e.date}T${e.time}`);
      if(now>=t) sendEmail(e);
    }
  });
}

emailForm.addEventListener("submit",ev=>{
  ev.preventDefault();
  emails.push({
    to:to.value,
    subject:subject.value,
    message:message.value,
    date:date.value,
    time:time.value,
    status:"pending"
  });
  save(); render();
  showMsg("Email scheduled ðŸŽ¯","success");
});

setInterval(checkEmails,30000);
render();
</script>

</body>
</html>
